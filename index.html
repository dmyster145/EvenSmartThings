<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Even SmartThings — Scenes on G2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      :root {
        --tc-1st: #232323;
        --tc-2nd: #7B7B7B;
        --tc-highlight: #FFFFFF;
        --tc-red: #FF4535;
        --bc-1st: #FFFFFF;
        --bc-2nd: #F6F6F6;
        --bc-3rd: #EEEEEE;
        --bc-4th: #E4E4E4;
        --bc-accent: #FEF991;
        --bc-highlight: #232323;
        --bg-primary: var(--bc-3rd);
        --bg-card: var(--bc-1st);
        --text-primary: var(--tc-1st);
        --text-secondary: var(--tc-2nd);
        --accent: var(--bc-accent);
        --accent-dark: #E5E082;
        --border: var(--bc-4th);
      }
      * { box-sizing: border-box; margin: 0; padding: 0; }
      body {
        font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: var(--bc-3rd);
        color: var(--tc-1st);
        min-height: 100vh;
        padding: 12px;
        font-size: 15px;
        font-weight: 400;
        line-height: 40px;
        letter-spacing: -0.11px;
      }
      .container { max-width: 720px; margin: 0 auto; }
      .header { text-align: center; padding: 24px 0; margin-bottom: 24px; }
      .logo-text { font-size: 24px; font-weight: 600; letter-spacing: 1px; }
      .subtitle { color: var(--text-secondary); font-size: 13px; margin-top: 8px; }
      .panel {
        background: var(--bc-1st);
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 24px;
      }
      .panel h1 { font-size: 17px; font-weight: 500; letter-spacing: -0.17px; line-height: 1.2; margin-bottom: 6px; }
      .panel h2 { font-size: 13px; font-weight: 500; letter-spacing: -0.13px; color: var(--tc-2nd); margin: 24px 0 12px; }
      .panel h2:first-of-type { margin-top: 0; }
      .panel p { font-size: 15px; font-weight: 300; line-height: 30px; color: var(--tc-2nd); margin-bottom: 12px; letter-spacing: -0.11px; }
      label { display: block; font-size: 11px; font-weight: 500; margin-bottom: 6px; color: var(--tc-1st); }
      input[type="password"], input[type="text"], select {
        width: 100%; padding: 10px 12px; font-size: 15px; border: 1px solid var(--border);
        border-radius: 6px; margin-bottom: 12px; background: var(--bc-2nd);
      }
      button {
        padding: 10px 20px; font-size: 15px; border: none; border-radius: 6px; cursor: pointer;
        background: var(--bc-highlight); color: var(--tc-highlight);
      }
      button:hover { opacity: 0.9; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }
      button:focus-visible, input:focus-visible, select:focus-visible { outline: 2px solid var(--bc-highlight); outline-offset: 2px; }
      button.secondary { background: var(--bc-4th); color: var(--tc-1st); }
      button.negative { background: var(--tc-red); color: var(--tc-highlight); }
      a { color: var(--tc-1st); }
      #app { display: none; }
      #config { display: none; }
      #open-in-even { display: block; }
      #glasses-active { display: none; }
      .config-section { margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border); }
      .config-section:first-of-type { margin-top: 0; padding-top: 0; border-top: none; }
      .list-order-row { display: flex; align-items: center; gap: 12px; margin-bottom: 6px; }
      .list-order-row label { margin-bottom: 0; min-width: 80px; }
      .list-order-row select { flex: 1; margin-bottom: 0; }
      .stats-toggles { display: grid; gap: 6px; }
      .stats-toggles .toggle-row { display: flex; align-items: center; gap: 10px; margin-bottom: 0; cursor: pointer; font-size: 13px; }
      .stats-toggles .toggle-row input { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }
      .stats-toggles .toggle-switch {
        flex-shrink: 0; width: 40px; height: 22px; border-radius: 11px; background: var(--bc-4th);
        position: relative; transition: background 0.2s ease;
      }
      .stats-toggles .toggle-switch::after {
        content: ''; position: absolute; width: 18px; height: 18px; border-radius: 50%;
        background: var(--bc-1st); top: 2px; left: 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        transition: transform 0.2s ease;
      }
      .stats-toggles .toggle-row input:checked + .toggle-switch { background: var(--bc-highlight); }
      .stats-toggles .toggle-row input:checked + .toggle-switch::after { transform: translateX(18px); }
      .stats-toggles .toggle-row:focus-within .toggle-switch { outline: 2px solid var(--bc-highlight); outline-offset: 2px; }
      .stats-toggles .toggle-label { user-select: none; }
      .favorites-list, .renames-list { list-style: none; margin: 0; padding: 0; }
      .favorites-list li, .renames-list li {
        display: flex; align-items: center; justify-content: space-between; gap: 8px;
        padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 13px;
      }
      .favorites-list button, .renames-list button { padding: 4px 10px; font-size: 11px; }
      .favorites-list + p, .renames-list + p { margin-top: 16px; }
      .empty-state { font-size: 13px; color: var(--tc-2nd); padding: 12px 0; border-bottom: none; list-style: none; }
      #config-status { min-height: 1.4em; font-size: 13px; color: var(--tc-2nd); margin-top: 12px; }
      .toast { padding: 12px 16px; border-radius: 6px; background: var(--bc-accent); margin-top: 12px; font-size: 13px; }
      .toast.error { background: var(--bc-accent); color: var(--tc-red); }
      .doc-link {
        display: inline-block; margin-top: 12px; padding: 10px 20px;
        background: var(--bc-accent); color: var(--tc-1st); border-radius: 6px;
        text-decoration: none; font-weight: 500; font-size: 15px;
      }
      .doc-link:hover { background: var(--accent-dark); }
      .doc-link:focus-visible { outline: 2px solid var(--bc-highlight); outline-offset: 2px; }
      .custom-order-hint { font-size: 11px; color: var(--tc-2nd); margin-bottom: 6px; }
      .custom-order-controls { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }
      .custom-order-controls button:last-child { margin-left: auto; }
      .custom-order-list { margin-top: 8px; }
      .custom-order-list[hidden] { display: none; }
      .reorder-list { list-style: none; margin: 0; padding: 0; }
      .reorder-list li {
        display: flex; align-items: center; padding: 8px 12px; margin-bottom: 4px;
        background: var(--bc-2nd); border-radius: 6px; cursor: pointer; border: 2px solid transparent;
      }
      .reorder-list li:hover { background: var(--bc-4th); }
      .reorder-list li.selected { border-color: var(--bc-highlight); background: var(--bc-accent); }
      .confirm-box { margin-top: 16px; padding: 12px; background: var(--bc-2nd); border-radius: 6px; }
      .confirm-box p { margin-bottom: 12px; }
      .debug-box { margin-top: 20px; padding: 12px; background: var(--bc-highlight); border-radius: 6px; max-height: 280px; overflow-y: auto; }
      .debug-box .debug-title { font-size: 11px; font-weight: 500; color: var(--tc-highlight); margin-bottom: 8px; }
      .debug-box pre { font-size: 11px; color: var(--tc-highlight); opacity: 0.9; white-space: pre-wrap; word-break: break-all; margin: 0; }
      .picker-box, .form-box { margin-top: 12px; padding: 12px; background: var(--bc-2nd); border-radius: 6px; }
      .picker-box label + label, .form-box label + label { margin-top: 8px; }
      .picker-box p, .form-box p { margin-top: 8px; margin-bottom: 0; }
      .btn-group { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
      #picker-cancel-btn, #rename-cancel-btn { margin-left: auto; }
      .dev-only { display: none; }
    </style>
  </head>
  <body>
    <script>
      (function(){ var g = typeof globalThis !== 'undefined' ? globalThis : window; g.process = g.process || { env: {} }; })();
    </script>
    <div class="container">
      <header class="header">
        <div class="logo-text">EVEN · SMARTTHINGS</div>
        <p class="subtitle">Scenes and devices on Even Realities G2 Glasses</p>
      </header>
    </div>
    <div id="app"></div>

    <div id="config" class="container panel">
      <h1>SmartThings token</h1>
      <p>Stored on this device only.</p>
      <form id="config-form">
        <label for="pat">Personal Access Token</label>
        <input type="password" id="pat" name="pat" placeholder="Paste your PAT" autocomplete="off" />
        <button type="submit" id="config-save-btn">Save</button>
        <p id="config-status" role="status" aria-live="polite"></p>
      </form>
    </div>

    <div id="open-in-even" class="container panel">
      <h1>Open in Even App</h1>
      <p>Open this page in the Even App on your phone to use the widget.</p>
    </div>

    <div id="glasses-active" class="container" style="display: none;">

      <div class="panel config-section">
        <h2>List order</h2>
        <p>How each list is sorted on the glasses. For Custom: select an item, then use Up/Down to reorder.</p>
        <div class="list-order-row">
          <label for="list-order-main">Home screen</label>
          <select id="list-order-main"><option value="alphabetical">Alphabetical</option><option value="reverse">Reverse</option><option value="custom">Custom</option></select>
        </div>
        <div id="custom-order-main" class="custom-order-list" hidden>
          <p class="custom-order-hint">Select item, then use Up/Down to reorder.</p>
          <div class="custom-order-controls">
            <button type="button" id="custom-order-main-up" class="secondary" aria-label="Move up">↑ Up</button>
            <button type="button" id="custom-order-main-down" class="secondary" aria-label="Move down">↓ Down</button>
            <button type="button" id="custom-order-main-done" class="secondary">Done</button>
          </div>
          <ul id="custom-order-main-ul" class="reorder-list"></ul>
        </div>
        <div class="list-order-row">
          <label for="list-order-scenes">Scenes</label>
          <select id="list-order-scenes"><option value="alphabetical">Alphabetical</option><option value="reverse">Reverse</option><option value="custom">Custom</option></select>
        </div>
        <div id="custom-order-scenes" class="custom-order-list" hidden>
          <p class="custom-order-hint">Select item, then use Up/Down to reorder.</p>
          <div class="custom-order-controls">
            <button type="button" id="custom-order-scenes-up" class="secondary" aria-label="Move up">↑ Up</button>
            <button type="button" id="custom-order-scenes-down" class="secondary" aria-label="Move down">↓ Down</button>
            <button type="button" id="custom-order-scenes-done" class="secondary">Done</button>
          </div>
          <ul id="custom-order-scenes-ul" class="reorder-list"></ul>
        </div>
        <div class="list-order-row">
          <label for="list-order-rooms">Rooms</label>
          <select id="list-order-rooms"><option value="alphabetical">Alphabetical</option><option value="reverse">Reverse</option><option value="custom">Custom</option></select>
        </div>
        <div id="custom-order-rooms" class="custom-order-list" hidden>
          <p class="custom-order-hint">Select item, then use Up/Down to reorder.</p>
          <div class="custom-order-controls">
            <button type="button" id="custom-order-rooms-up" class="secondary" aria-label="Move up">↑ Up</button>
            <button type="button" id="custom-order-rooms-down" class="secondary" aria-label="Move down">↓ Down</button>
            <button type="button" id="custom-order-rooms-done" class="secondary">Done</button>
          </div>
          <ul id="custom-order-rooms-ul" class="reorder-list"></ul>
        </div>
        <div class="list-order-row">
          <label for="list-order-devices">Devices</label>
          <select id="list-order-devices"><option value="alphabetical">Alphabetical</option><option value="reverse">Reverse</option><option value="custom">Custom</option></select>
        </div>
        <div id="custom-order-devices" class="custom-order-list" hidden>
          <p class="custom-order-hint">Select item, then use Up/Down to reorder.</p>
          <div class="custom-order-controls">
            <button type="button" id="custom-order-devices-up" class="secondary" aria-label="Move up">↑ Up</button>
            <button type="button" id="custom-order-devices-down" class="secondary" aria-label="Move down">↓ Down</button>
            <button type="button" id="custom-order-devices-done" class="secondary">Done</button>
          </div>
          <ul id="custom-order-devices-ul" class="reorder-list"></ul>
        </div>
        <div class="list-order-row">
          <label for="list-order-favorites">Favorites</label>
          <select id="list-order-favorites"><option value="alphabetical">Alphabetical</option><option value="reverse">Reverse</option><option value="custom">Custom</option></select>
        </div>
        <div id="custom-order-favorites" class="custom-order-list" hidden>
          <p class="custom-order-hint">Select item, then use Up/Down to reorder.</p>
          <div class="custom-order-controls">
            <button type="button" id="custom-order-favorites-up" class="secondary" aria-label="Move up">↑ Up</button>
            <button type="button" id="custom-order-favorites-down" class="secondary" aria-label="Move down">↓ Down</button>
            <button type="button" id="custom-order-favorites-done" class="secondary">Done</button>
          </div>
          <ul id="custom-order-favorites-ul" class="reorder-list"></ul>
        </div>
      </div>

      <div class="panel config-section">
        <h2>Stats visibility</h2>
        <p>Show or hide stats on the glasses.</p>
        <div class="stats-toggles" id="stats-toggles">
          <label class="toggle-row"><input type="checkbox" id="stat-totalDevices" /><span class="toggle-switch" aria-hidden="true"></span><span class="toggle-label">Total Devices</span></label>
          <label class="toggle-row"><input type="checkbox" id="stat-online" /><span class="toggle-switch" aria-hidden="true"></span><span class="toggle-label">Online</span></label>
          <label class="toggle-row"><input type="checkbox" id="stat-offline" /><span class="toggle-switch" aria-hidden="true"></span><span class="toggle-label">Offline</span></label>
          <label class="toggle-row"><input type="checkbox" id="stat-deviceType" /><span class="toggle-switch" aria-hidden="true"></span><span class="toggle-label">Device Type</span></label>
          <label class="toggle-row"><input type="checkbox" id="stat-protocol" /><span class="toggle-switch" aria-hidden="true"></span><span class="toggle-label">Protocol</span></label>
          <label class="toggle-row"><input type="checkbox" id="stat-onlineStatus" /><span class="toggle-switch" aria-hidden="true"></span><span class="toggle-label">Online Status</span></label>
          <label class="toggle-row"><input type="checkbox" id="stat-switchStatus" /><span class="toggle-switch" aria-hidden="true"></span><span class="toggle-label">On / Off Status</span></label>
          <label class="toggle-row"><input type="checkbox" id="stat-brightness" /><span class="toggle-switch" aria-hidden="true"></span><span class="toggle-label">Brightness</span></label>
          <label class="toggle-row"><input type="checkbox" id="stat-capabilityReadings" /><span class="toggle-switch" aria-hidden="true"></span><span class="toggle-label">Capability readings</span></label>
        </div>
      </div>

      <div class="panel config-section">
        <h2>Favorites</h2>
        <p>Scenes and devices in one list on the glasses.</p>
        <ul class="favorites-list" id="favorites-list"></ul>
        <p><button type="button" id="add-favorite-btn" class="secondary">Add to Favorites</button></p>
        <div id="add-favorite-picker" class="picker-box" style="display: none;">
          <label>Scenes</label>
          <select id="picker-scenes" size="4"></select>
          <label>Devices</label>
          <select id="picker-devices" size="4"></select>
          <p class="btn-group"><button type="button" id="picker-add-btn">Add selected</button> <button type="button" id="picker-cancel-btn" class="secondary">Done</button></p>
        </div>
      </div>

      <div class="panel config-section">
        <h2>Custom names</h2>
        <p>Display names for devices, rooms, or scenes (this app only).</p>
        <ul class="renames-list" id="renames-list"></ul>
        <p><button type="button" id="add-rename-btn" class="secondary">Add custom name</button></p>
        <div id="add-rename-form" class="form-box" style="display: none;">
          <label>Type</label>
          <select id="rename-type"><option value="scene">Scene</option><option value="room">Room</option><option value="device">Device</option></select>
          <label>Item</label>
          <select id="rename-item"></select>
          <label>Display name</label>
          <input type="text" id="rename-name" placeholder="New name" maxlength="64" />
          <p class="btn-group"><button type="button" id="rename-save-btn">Save</button> <button type="button" id="rename-cancel-btn" class="secondary">Done</button></p>
        </div>
      </div>

      <div class="panel config-section">
        <h2>SmartThings token</h2>
        <p>Scroll Scenes, Devices, or Favorites on your G2 glasses; tap to run or control.</p>
        <p class="btn-group">
          <button type="button" id="delete-token-btn" class="secondary">Delete token</button>
          <button type="button" id="toggle-debug-btn" class="secondary dev-only">Show debug log</button>
        </p>
        <div id="delete-token-confirm" class="confirm-box" style="display: none;">
          <p>Delete the saved token? You'll need to enter a new one to continue.</p>
          <button type="button" id="delete-token-confirm-cancel" class="secondary">Cancel</button>
          <button type="button" id="delete-token-confirm-do" class="negative">Delete token</button>
        </div>
        <div id="debug-log-container" class="debug-box" style="display: none;">
          <div class="debug-title">Debug log</div>
          <pre id="debug-log"></pre>
        </div>
      </div>

      <div class="panel config-section">
        <h2>Documentation</h2>
        <a href="doc.html" target="_blank" rel="noopener" class="doc-link">Open Documentation</a>
      </div>

      <div id="config-toast" class="toast" role="status" aria-live="polite" style="display: none;"></div>
    </div>

    <script type="module" src="/src/bootstrap.ts"></script>
  </body>
</html>
